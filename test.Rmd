---
title: 'xGPhilosophy Tweet Engagement'
# runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    css: custom.css
    orientation: columns
    vertical_layout: scroll
---

```{r setup, include=F, echo=F}
knitr::opts_chunk$set(
  # collapse = TRUE
  echo = FALSE,
  warning = FALSE,
  message = FALSE
)
```

```{r import, include=F}
source('functions.R')
preds <- import_preds()
shap <- import_shap()

if(FALSE) {
df <-
  shap %>%
  nest(shap = -c(stem, idx)) %>%
  # head(5) %>% 
  mutate(
    shap = map(shap, .prep_shap)
  ) %>% 
  select(idx, stem, shap) %>%
  pivot_wider(names_from = stem, values_from = shap, names_glue = '{stem}_shap') %>%
  left_join(preds, by = 'idx')
df
readr::write_rds(df, 'df.rds')
}
df <- readr::read_rds('df.rds')

preds_key <- preds %>% plotly::highlight_key( ~ text, group = 'Select a tweet')
# shap_key <- shap %>% plotly::highlight_key(~text, group = 'Select a tweet')
df_key <- df %>% plotly::highlight_key(~text)

plot_time <-
  purrr::partial(
    plot_stem_time,
    # data = preds_key,
    data = df_key,
    width = 475,
    height = 475,
    ... =
  )
plot_pred <-
  purrr::partial(
    plot_stem_pred,
    data = preds_key,
    height = 475,
    width = 475,
    ... =
  )
plot_shap <-
  purrr::partial(
    plot_stem_shap,
    data = df_key,
    height = 475,
    width = 475,
    ... =
  )
```

## Column {data-width="333"}

### Favorites {data-height="333"}

```{r}
plot_time('favorite')
```

### Retweets {data-height="333"}

```{r}
plot_time('retweet')
```

## Column {data-width="333"}

### Favorite Predictions {data-height="500"}

```{r}
plot_pred('favorite')
```

### Retweet Predictions {data-height="500"}

```{r}
plot_pred('retweet')
```

## Column {data-width="333"}

### Favorite Prediction Explanation {data-height="500"}

```{r}
plot_shap('favorite')
```

### Retweets Prediction Explanation {data-height="500"}
